<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Data Creator - Citizen Connect</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: #f8fafb;
      color: #1a1a1a;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }
    .test-section {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .test-button {
      background: #4285f4;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s ease;
    }
    .test-button:hover {
      background: #3367d6;
      transform: translateY(-1px);
    }
    .status {
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 14px;
    }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    .data-preview {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
      border-left: 4px solid #4285f4;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>üß™ Test Data Creator</h1>
  
  <div class="test-section">
    <h2>Step 1: Create Test Data</h2>
    <button class="test-button" onclick="createTestData()">üöÄ Create Test Data</button>
    <div id="createStatus" class="status info">Click to create test data</div>
  </div>

  <div class="test-section">
    <h2>Step 2: Test Report Page</h2>
    <button class="test-button" onclick="openReportPage()">üìù Open Report Page</button>
    <div id="testStatus" class="status info">Test the report page after creating data</div>
  </div>

  <div class="test-section">
    <h2>Step 3: Check Current Data</h2>
    <button class="test-button" onclick="checkCurrentData()">üîç Check Data</button>
    <div id="dataStatus" class="status info">Click to check current data</div>
  </div>

  <div class="test-section">
    <h2>Step 4: Clear All Data</h2>
    <button class="test-button" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
    <div id="clearStatus" class="status info">Clear all test data</div>
  </div>

  <script>
    function createTestData() {
      try {
        // Create a simple base64 image (100x100 red square)
        const canvas = document.createElement('canvas');
        canvas.width = 100;
        canvas.height = 100;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#ff0000';
        ctx.fillRect(0, 0, 100, 100);
        const testPhoto = canvas.toDataURL('image/png');
        
        // Create test location
        const testLocation = {
          address: "123 Test Street, Test City, TC 12345",
          lat: 40.7128,
          lon: -74.0060,
          manual: false,
          timestamp: new Date().toISOString()
        };
        
        // Store test data
        localStorage.setItem('capturedPhoto', testPhoto);
        localStorage.setItem('photoTimestamp', new Date().toISOString());
        localStorage.setItem('reportLocation', JSON.stringify(testLocation));
        localStorage.setItem('reportedIssueLocation', testLocation.address);
        
        document.getElementById('createStatus').innerHTML = `
          <div class="success">‚úÖ Test data created successfully!</div>
          <div class="data-preview">
            üì∏ Photo: ${testPhoto.length} characters<br>
            üìç Location: ${testLocation.address}<br>
            üïê Timestamp: ${new Date().toISOString()}
          </div>
        `;
        
        console.log('‚úÖ Test data created successfully!');
        console.log('üì∏ Photo data length:', testPhoto.length);
        console.log('üìç Location:', testLocation.address);
        
      } catch (error) {
        document.getElementById('createStatus').innerHTML = `
          <div class="error">‚ùå Error creating test data: ${error.message}</div>
        `;
        console.error('Error creating test data:', error);
      }
    }

    function openReportPage() {
      // Check if we have required data first
      const photo = localStorage.getItem('capturedPhoto');
      const location = localStorage.getItem('reportedIssueLocation');
      
      if (!photo || !location) {
        document.getElementById('testStatus').innerHTML = `
          <div class="error">‚ùå Missing required data. Please create test data first.</div>
        `;
        return;
      }
      
      document.getElementById('testStatus').innerHTML = `
        <div class="success">‚úÖ Opening report page with test data...</div>
      `;
      
      setTimeout(() => {
        window.location.href = 'User UI/Report Issue Page/index.html';
      }, 500);
    }

    function checkCurrentData() {
      try {
        const photo = localStorage.getItem('capturedPhoto');
        const location = localStorage.getItem('reportedIssueLocation');
        const locationData = localStorage.getItem('reportLocation');
        const photoTimestamp = localStorage.getItem('photoTimestamp');
        
        let status = '<div class="info">üìä Current localStorage Data:</div>';
        
        if (photo) {
          status += `<div class="data-preview">‚úÖ Photo: Available (${photo.length} characters)<br>Timestamp: ${photoTimestamp || 'N/A'}</div>`;
        } else {
          status += '<div class="error">‚ùå Photo: Not found</div>';
        }
        
        if (location) {
          status += `<div class="data-preview">‚úÖ Location: ${location}</div>`;
        } else {
          status += '<div class="error">‚ùå Location: Not found</div>';
        }
        
        if (locationData) {
          const parsed = JSON.parse(locationData);
          status += `<div class="data-preview">‚úÖ Location Data: ${parsed.address}</div>`;
        } else {
          status += '<div class="error">‚ùå Location Data: Not found</div>';
        }
        
        // Check for existing issues
        const userIssues = localStorage.getItem('userIssues');
        if (userIssues) {
          const issues = JSON.parse(userIssues);
          status += `<div class="data-preview">üìã Existing Issues: ${issues.length} reports</div>`;
        } else {
          status += '<div class="info">üìã Existing Issues: None</div>';
        }
        
        document.getElementById('dataStatus').innerHTML = status;
        
      } catch (error) {
        document.getElementById('dataStatus').innerHTML = `
          <div class="error">‚ùå Error checking data: ${error.message}</div>
        `;
        console.error('Data check error:', error);
      }
    }

    function clearAllData() {
      try {
        localStorage.removeItem('capturedPhoto');
        localStorage.removeItem('photoTimestamp');
        localStorage.removeItem('reportLocation');
        localStorage.removeItem('reportedIssueLocation');
        localStorage.removeItem('userIssues');
        
        document.getElementById('clearStatus').innerHTML = `
          <div class="success">‚úÖ All test data cleared successfully!</div>
        `;
        
        console.log('‚úÖ All test data cleared');
        
      } catch (error) {
        document.getElementById('clearStatus').innerHTML = `
          <div class="error">‚ùå Error clearing data: ${error.message}</div>
        `;
        console.error('Clear data error:', error);
      }
    }

    // Initialize on load
    window.onload = function() {
      checkCurrentData();
    };
  </script>
</body>
</html>